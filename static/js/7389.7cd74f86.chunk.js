"use strict";(self.webpackChunkfrontend_app=self.webpackChunkfrontend_app||[]).push([[7389],{67389:(e,n,t)=>{t.r(n),t.d(n,{default:()=>Y});var i=t(96447),s=t(93714),a=t(47313),l=t(9019),o=t(79536),r=t(47825),m=t(9289),c=t(47131),d=t(65033),u=t(19536),_=t(16429),x=t(83929),g=t(44758),h=t(99881),p=t(33223),y=t(86138),f=t(19860),j=t(90200),Z=t(7547),v=t(15535),b=t(37735),S=t(95087),w=t(92556),C=t(63408),k=t(58467),I=t(90469),P=t(38556);const z={root:"styles_root__CJAeV",container:"styles_container__Fnrca",mainContent:"styles_mainContent__bCgCc",generalInfo:"styles_generalInfo__hDgbF",textEditor:"styles_textEditor__IT8I8",submissionTime:"styles_submissionTime__+J8ny",formBody:"styles_formBody__XCHVO",toolBar:"styles_toolBar__qx0RI",breadcumpWrapper:"styles_breadcumpWrapper__u5Y2h",icArrow:"styles_icArrow__0JM2r",cursorPointer:"styles_cursorPointer__9SYmP",drawerBody:"styles_drawerBody__xKnE7",drawerFieldContainer:"styles_drawerFieldContainer__2Qv0Q",action:"styles_action__ebJRQ",shake:"styles_shake__dLWkA",slideUp:"styles_slideUp__luZR0"};var O=t(47477),B=t(75590),F=t(70816),N=t.n(F),L=t(91603),U=t(33060),E=t(54750),T=t(46417);const A=(0,E.Z)((0,T.jsx)("path",{d:"M10 6 8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}),"NavigateNext");var q=t(33099),D=t(21933),M=t(62563),Q=t(75627),H=t(23885),R=t(16705),V=t(65537);function Y(){var e;const{t:n,i18n:t}=(0,B.$G)(),[F,E]=(0,a.useState)((()=>H.ZP.language)),{width:Y}=(0,P.Z)(),W=(0,k.s0)(),[K,X]=((0,f.Z)(),(0,a.useState)(!0)),[J,G]=(0,a.useState)(!1),[$,ee]=(0,a.useState)([]),[ne,te]=(0,a.useState)(!0),[ie,se]=(0,a.useState)(!1),[ae,le]=(0,a.useState)(!1),[oe,re]=(0,a.useState)(!1),[me,ce]=(0,a.useState)(!1),[de,ue]=(0,a.useState)(!0),[_e,xe]=(0,a.useState)(!0),[ge,he]=(0,a.useState)(null),{courseId:pe,assignmentId:ye}=(0,k.UO)(),fe=(0,V.v9)((e=>e.course));console.log(_e);(0,a.useEffect)((()=>{t.language!==F&&null!==Se&&void 0!==Se&&Se.name&&(we(),E(t.language))}),[t.language]);const je=(0,a.useMemo)((()=>D.Ry().shape({name:D.Z_().required("assignment_name_required"),intro:D.Z_(),activity:D.Z_(),maxScore:D.Rx().required("assignment_management_max_score_required"),timeOpen:D.Z_().required("assignment_management_allow_submission_from_date_required"),timeClose:D.Z_().required("assignment_management_submission_due_date_required"),wordLimit:D.Z_(),maxUploadedFile:D.Z_().required("assignment_management_max_uploaded_file_required"),maxFileSize:D.Z_().required("assignment_management_max_file_size_required")})),[n]),{control:Ze,handleSubmit:ve,watch:be,formState:{errors:Se},trigger:we,setValue:Ce}=(0,Q.cI)({resolver:(0,M.X)(je),defaultValues:{name:"",intro:"",activity:"",maxScore:100,timeOpen:N().utc().add(0,"days").toISOString(),timeClose:N().utc().add(7,"days").toISOString(),wordLimit:"",maxUploadedFile:"20",maxFileSize:"40000"}}),ke=(0,a.useCallback)((async e=>{try{const n=await R.Y.createIntroAttachment(e);if(n)return console.log("Create intro attachment successfully"),n}catch(n){console.log(n)}return null}),[]),Ie=(0,a.useCallback)((async(e,n)=>{try{await R.Y.updateIntroAttachment(e,n)&&console.log("Update intro attachment successfully")}catch(t){console.log(t)}}),[]),Pe=(0,a.useCallback)((async e=>{try{const n=await R.Y.createAssignment(e);if(n)return console.log("Create assignment successfully"),n}catch(n){console.log(n)}return null}),[]),ze=(0,a.useCallback)((async(e,n)=>{try{const t=await R.Y.updateAssignment(e,n);if(t)return console.log("Update assignment successfully"),t}catch(t){console.log(t)}return null}),[]),Oe=(0,a.useCallback)((async e=>{try{await R.Y.deleteIntroAttachment(e)&&console.log("Delete all intro attachment successfully")}catch(n){console.log(n)}}),[]);(0,a.useEffect)((()=>{ye&&(async e=>{try{const n=await R.Y.getAssignmentById(e);n&&he(n)}catch(n){console.log(n)}})(ye)}),[]),(0,a.useEffect)((()=>{var e;ge&&(console.log(ge),Ce("name",ge.title),Ce("intro",ge.intro),Ce("activity",ge.activity),Ce("maxScore",ge.maxScore),Ce("timeOpen",ge.timeOpen instanceof Date?ge.timeOpen.toISOString():ge.timeOpen),Ce("timeClose",ge.timeClose instanceof Date?ge.timeClose.toISOString():ge.timeClose),Ce("wordLimit",ge.wordLimit),Ce("maxUploadedFile",ge.maxUploadFiles),Ce("maxFileSize",ge.maxFileSize),"BOTH"===ge.type?(ce(!0),ue(!0)):"TEXT_ONLINE"===ge.type?(ce(!0),ue(!1)):(ce(!1),ue(!0)),ee(null===ge||void 0===ge?void 0:ge.introAttachments.map((e=>{let n=new File([""],e.fileName,{type:e.mimetype,lastModified:(new Date).getTime()});return{id:e.id,name:e.fileName,size:e.fileSize,type:e.mimetype,downloadUrl:e.fileUrl,imageUrl:e.fileUrl,file:n,uploadStatus:"success"}})))),xe(null===(e=null===ge||void 0===ge?void 0:ge.allowSubmitLate)||void 0===e||e)}),[ge]),(0,a.useEffect)((()=>{X(!(Y<1080))}),[Y]);const Be=(0,a.useRef)(null),{height:Fe}=(0,O.Z)({ref:Be}),Ne=(0,a.useRef)(null),{height:Le}=(0,O.Z)({ref:Ne}),Ue=Array.from({length:20},((e,n)=>({value:(n+1).toString(),label:(n+1).toString()}))),Ee=[{value:"10",label:"10 KB"},{value:"50",label:"50 KB"},{value:"100",label:"100 KB"},{value:"500",label:"500 KB"},{value:"1000",label:"1 MB"},{value:"2000",label:"2 MB"},{value:"5000",label:"5 MB"},{value:"10000",label:"10 MB"},{value:"20000",label:"20 MB"},{value:"40000",label:"40 MB"}],[Te,Ae]=(0,a.useState)(!1),[qe,De]=(0,a.useState)(!1);return(0,T.jsxs)(l.ZP,{className:z.root,children:[(0,T.jsx)(j.Z,{ref:Be}),(0,T.jsx)(o.Z,{sx:{marginTop:"".concat(Fe,"px")},className:z.container,children:(0,T.jsxs)(r.Z,{children:[(0,T.jsx)(m.Z,{className:z.toolBar,children:(0,T.jsxs)(o.Z,{id:z.breadcumpWrapper,children:[(0,T.jsx)(C.Z,{colorname:"--blue-500",className:z.cursorPointer,onClick:()=>W(I._.lecturer.course.management),"translation-key":"common_course_management",children:n("common_course_management")}),(0,T.jsx)(i.Z,{id:z.icArrow}),(0,T.jsx)(C.Z,{colorname:"--blue-500",className:z.cursorPointer,onClick:()=>W(I._.lecturer.course.information.replace(":courseId",null!==pe&&void 0!==pe?pe:"")),children:null===(e=fe.courseDetail)||void 0===e?void 0:e.name}),(0,T.jsx)(i.Z,{id:z.icArrow}),(0,T.jsx)(C.Z,{colorname:"--blue-500",className:z.cursorPointer,onClick:()=>W(I._.lecturer.course.assignment.replace(":courseId",null!==pe&&void 0!==pe?pe:"")),"translation-key":"course_detail_assignment_list",children:n("course_detail_assignment_list")}),(0,T.jsx)(i.Z,{id:z.icArrow}),ge?(0,T.jsx)(C.Z,{colorname:"--blue-500","translation-key":"assignment_management_update_assignment",children:n("assignment_management_update_assignment")}):(0,T.jsx)(C.Z,{colorname:"--blue-500","translation-key":"assignment_management_create_assignment",children:n("assignment_management_create_assignment")})]})}),(0,T.jsxs)("form",{className:z.mainContent,style:{height:"calc(100% - ".concat(Le+Fe,"px)"),marginTop:"".concat(Le,"px")},onSubmit:ve((async e=>{if(!me&&!de)return re(!0),void setTimeout((()=>re(!1)),2e3);G(!0);const n={...e},{name:t,intro:i,activity:s,maxScore:a,timeOpen:l,timeClose:o,wordLimit:r,maxUploadedFile:m,maxFileSize:c}=n;let d=[],u=[];try{if(ge){const e=ge.introAttachments||[],n=$.filter((n=>!e.some((e=>e.id===n.id)))),t=e.filter((e=>!$.some((n=>n.id===e.id))));for(const i of t)await Oe(i.id);for(const i of n){const e={fileName:i.name||"",fileUrl:i.downloadUrl||"",fileSize:i.size||0,mimeType:i.type||"",timeModified:(new Date).toISOString()},n=await ke(e);n&&(d.push(e),u.push(n.id))}}else for(const n of $){const e={fileName:n.name||"",fileUrl:n.downloadUrl||"",fileSize:n.size||0,mimeType:n.type||"",timeModified:(new Date).toISOString()},t=await ke(e);t&&(d.push(e),u.push(t.id))}let e;if(ge?(console.log(ge.id),e=await ze({title:t,intro:i,activity:s,wordLimit:r,maxUploadFiles:m,maxFileSize:c,maxScore:a,timeOpen:l,timeClose:o,type:me&&de?"BOTH":me?"TEXT_ONLINE":"FILE",visible:!0,allowSubmitLate:_e},ge.id)):e=await Pe({courseId:null!==pe&&void 0!==pe?pe:"",title:t,intro:i,activity:s,wordLimit:r,maxUploadFiles:m,maxFileSize:c,maxScore:a,timeOpen:l,timeClose:o,type:me&&de?"BOTH":me?"TEXT_ONLINE":"FILE",visible:!0,allowSubmitLate:_e}),e&&d.length>0)for(let n=0;n<d.length;n++){const t={...d[n],assignmentId:e.assignmentId};console.log("temp",t),await Ie(t,u[n])}}catch(_){De(!0)}finally{G(!1),Ae(!0),setTimeout((()=>{W(I._.lecturer.course.assignment.replace(":courseId",null!==pe&&void 0!==pe?pe:""))}),2e3)}})),children:[ge?(0,T.jsx)(U.Z,{"translation-key":"assignment_management_update_assignment",children:n("assignment_management_update_assignment")}):(0,T.jsx)(U.Z,{"translation-key":"assignment_management_create_assignment",children:n("assignment_management_create_assignment")}),(0,T.jsxs)(o.Z,{className:z.generalInfo,children:[(0,T.jsxs)(o.Z,{display:"flex",alignItems:"center",margin:1,children:[ne?(0,T.jsx)(c.Z,{sx:{padding:"5px"},onClick:()=>te(!ne),children:(0,T.jsx)(s.Z,{style:{fontSize:30}})}):(0,T.jsx)(c.Z,{sx:{padding:"5px"},onClick:()=>te(!ne),children:(0,T.jsx)(A,{style:{fontSize:30}})}),(0,T.jsx)(q.Z,{fontWeight:500,"translation-key":"common_general",children:n("common_general")})]}),(0,T.jsx)(d.Z,{in:ne,timeout:"auto",unmountOnExit:!0,children:(0,T.jsxs)(o.Z,{display:"flex",flexDirection:"column",alignItems:"center",gap:2,marginLeft:3,marginBottom:2,children:[(0,T.jsx)(Q.Qr,{defaultValue:"",control:Ze,name:"name",rules:{required:!0},render:e=>{var t;let{field:{ref:i,...s}}=e;return(0,T.jsx)(L.Z,{titleAlignment:"horizontal",error:Boolean(null===Se||void 0===Se?void 0:Se.name),errorMessage:null===(t=Se.name)||void 0===t?void 0:t.message,title:n("common_assignment_name"),type:"text",placeholder:n("common_assignment_enter_name"),titleRequired:!0,"translation-key":["common_assignment_name","common_assignment_enter_name","assignment_name_required"],inputRef:i,...s})}}),(0,T.jsxs)(l.ZP,{container:!0,spacing:1,columns:12,children:[(0,T.jsx)(l.ZP,{item:!0,xs:3,children:(0,T.jsx)(C.Z,{"translation-key":"common_assignment_description",children:n("common_assignment_description")})}),(0,T.jsx)(l.ZP,{item:!0,xs:9,className:z.textEditor,"translation-key":"common_enter_description",children:(0,T.jsx)(Q.Qr,{control:Ze,name:"intro",render:e=>{let{field:t}=e;return(0,T.jsx)(w.Z,{openDialog:!0,roundedBorder:!0,placeholder:n("common_enter_description")+"...",onChange:t.onChange,value:t.value||""})}})})]}),(0,T.jsxs)(l.ZP,{container:!0,spacing:1,columns:12,children:[(0,T.jsx)(l.ZP,{item:!0,xs:3,children:(0,T.jsx)(C.Z,{"translation-key":"common_assignment_guide",children:n("common_assignment_guide")})}),(0,T.jsx)(l.ZP,{item:!0,xs:9,className:z.textEditor,"translation-key":"common_enter_guideline",children:(0,T.jsx)(Q.Qr,{control:Ze,name:"activity",render:e=>{let{field:t}=e;return(0,T.jsx)(w.Z,{openDialog:!0,roundedBorder:!0,placeholder:n("common_enter_guideline")+"...",...t,value:t.value||""})}})})]}),(0,T.jsxs)(l.ZP,{container:!0,spacing:1,columns:12,children:[(0,T.jsx)(l.ZP,{item:!0,xs:3,children:(0,T.jsx)(C.Z,{"translation-key":"asingment_management_attach_file",children:n("asingment_management_attach_file")})}),(0,T.jsx)(l.ZP,{item:!0,xs:9,children:(0,T.jsx)(S.Z,{extFiles:$,setExtFiles:ee})})]})]})})]}),(0,T.jsx)(u.Z,{}),(0,T.jsxs)(o.Z,{className:z.submissionTime,children:[(0,T.jsxs)(o.Z,{display:"flex",alignItems:"center",margin:1,children:[ie?(0,T.jsx)(c.Z,{sx:{padding:"5px"},onClick:()=>se(!ie),children:(0,T.jsx)(s.Z,{style:{fontSize:30}})}):(0,T.jsx)(c.Z,{sx:{padding:"5px"},onClick:()=>se(!ie),children:(0,T.jsx)(A,{style:{fontSize:30}})}),(0,T.jsx)(q.Z,{"translation-key":"common_time_setting",fontWeight:500,children:n("common_time_setting")})]}),(0,T.jsx)(d.Z,{in:ie,timeout:"auto",unmountOnExit:!0,children:(0,T.jsxs)(o.Z,{display:"flex",flexDirection:"column",alignItems:"center",gap:2,marginLeft:3,marginBottom:2,children:[(0,T.jsxs)(l.ZP,{container:!0,spacing:1,columns:12,children:[(0,T.jsx)(l.ZP,{item:!0,xs:3,children:(0,T.jsx)(C.Z,{"translation-key":"asingment_management_allow_time",children:n("asingment_management_allow_time")})}),(0,T.jsx)(l.ZP,{item:!0,xs:9,children:(0,T.jsx)(Q.Qr,{control:Ze,name:"timeOpen",rules:{required:!0},render:e=>{let{field:{ref:n,...t}}=e;return(0,T.jsx)(v.Z,{value:N()(t.value),onHandleValueChange:e=>{e&&Ce("timeOpen",e.toISOString())}})}})})]}),(0,T.jsxs)(l.ZP,{container:!0,spacing:1,columns:12,children:[(0,T.jsx)(l.ZP,{item:!0,xs:3,children:(0,T.jsx)(C.Z,{"translation-key":"asingment_management_deadline",children:n("asingment_management_deadline")})}),(0,T.jsx)(l.ZP,{item:!0,xs:9,children:(0,T.jsx)(Q.Qr,{control:Ze,name:"timeClose",rules:{required:!0},render:e=>{let{field:{ref:n,...t}}=e;return(0,T.jsx)(v.Z,{value:N()(t.value),onHandleValueChange:e=>{e&&Ce("timeClose",e.toISOString())}})}})})]}),(0,T.jsxs)(l.ZP,{container:!0,spacing:1,columns:12,children:[(0,T.jsx)(l.ZP,{item:!0,xs:3}),(0,T.jsx)(l.ZP,{item:!0,xs:9,children:(0,T.jsx)(_.Z,{style:{flexDirection:"row"},children:(0,T.jsx)(x.Z,{"translation-key":"common_allow_submission_after_end_time",control:(0,T.jsx)(g.Z,{checked:_e,onChange:e=>xe(e.target.checked),name:"textSubmission"}),label:n("common_allow_submission_after_end_time")})})})]})]})})]}),(0,T.jsx)(u.Z,{}),(0,T.jsxs)(o.Z,{className:z.submissionType,children:[(0,T.jsxs)(o.Z,{display:"flex",alignItems:"center",margin:1,children:[ae?(0,T.jsx)(c.Z,{sx:{padding:"5px"},onClick:()=>le(!ae),children:(0,T.jsx)(s.Z,{style:{fontSize:30}})}):(0,T.jsx)(c.Z,{sx:{padding:"5px"},onClick:()=>le(!ae),children:(0,T.jsx)(A,{style:{fontSize:30}})}),(0,T.jsx)(q.Z,{"translation-key":"common_submission_type",fontWeight:500,children:n("common_submission_type")})]}),(0,T.jsx)(d.Z,{in:ae,timeout:"auto",unmountOnExit:!0,children:(0,T.jsxs)(o.Z,{display:"flex",flexDirection:"column",gap:2,marginLeft:3,marginBottom:2,children:[(0,T.jsxs)(l.ZP,{container:!0,children:[(0,T.jsx)(l.ZP,{item:!0,xs:3,alignContent:"center",children:(0,T.jsx)(C.Z,{"translation-key":"common_submission_type",children:n("common_submission_type")})}),(0,T.jsxs)(l.ZP,{item:!0,xs:9,style:{position:"relative"},children:[(0,T.jsxs)(_.Z,{style:{flexDirection:"row"},children:[(0,T.jsx)(x.Z,{"translation-key":"common_submission_type_online_text",control:(0,T.jsx)(g.Z,{checked:me,onChange:e=>{ce(e.target.checked)},name:"textSubmission"}),label:n("common_submission_type_online_text")}),(0,T.jsx)(x.Z,{"translation-key":"common_submission_type_file",control:(0,T.jsx)(g.Z,{checked:de,onChange:e=>{ue(e.target.checked)},name:"fileSubmission"}),label:n("common_submission_type_file")})]}),oe&&(0,T.jsx)(h.Z,{className:oe?z.shake:z.slideUp,severity:"error",sx:{position:"absolute",top:-50,zIndex:9999},children:"H\xe3y ch\u1ecdn lo\u1ea1i b\xe0i t\u1eadp"})]})]}),me&&(0,T.jsx)(Q.Qr,{control:Ze,name:"wordLimit",render:e=>{var t;let{field:i}=e;return(0,T.jsx)(L.Z,{"translation-key":"common_enter_word_limit",widthInput:"200px",error:Boolean(null===Se||void 0===Se?void 0:Se.wordLimit),errorMessage:null===(t=Se.wordLimit)||void 0===t?void 0:t.message,titleAlignment:"horizontal",title:n("common_word_limit"),type:"number",placeholder:n("common_enter_word_limit"),...i,value:i.value||""})}}),de&&(0,T.jsxs)(l.ZP,{container:!0,children:[(0,T.jsx)(l.ZP,{item:!0,xs:3,alignContent:"center",children:(0,T.jsx)(C.Z,{"translation-key":"common_max_upload_file",children:n("common_max_upload_file")})}),(0,T.jsx)(l.ZP,{item:!0,xs:9,children:(0,T.jsx)(Q.Qr,{control:Ze,defaultValue:"40000",name:"maxUploadedFile",render:e=>{let{field:{onChange:n,value:t}}=e;return(0,T.jsx)(b.Z,{labelId:"maxUploadedFile",width:"50px",borderRadius:"12px",title:"Max number of uploaded files",onHandleChange:n,value:t,items:Ue})}})})]}),de&&(0,T.jsxs)(l.ZP,{container:!0,children:[(0,T.jsx)(l.ZP,{item:!0,xs:3,alignContent:"center",children:(0,T.jsx)(C.Z,{"translation-key":"common_max_submission_file_size",children:n("common_max_submission_file_size")})}),(0,T.jsx)(l.ZP,{item:!0,xs:9,children:(0,T.jsx)(Q.Qr,{control:Ze,name:"maxFileSize",render:e=>{let{field:{onChange:n,value:t}}=e;return(0,T.jsx)(b.Z,{labelId:"maxFileSize",width:"50px",borderRadius:"12px",title:"Maximum submission size",value:t,onHandleChange:n,items:Ee})}})})]}),(0,T.jsx)(Q.Qr,{control:Ze,name:"maxScore",render:e=>{var t;let{field:i}=e;return(0,T.jsx)(L.Z,{widthInput:"200px",titleAlignment:"horizontal",title:n("assignment_management_max_score"),type:"number",placeholder:"Nh\u1eadp \u0111i\u1ec3m t\u1ed1i \u0111a",error:Boolean(Se.maxScore),errorMessage:null===(t=Se.maxScore)||void 0===t?void 0:t.message,...i})}})]})})]}),(0,T.jsx)(u.Z,{}),(0,T.jsx)(o.Z,{className:z.action,children:(0,T.jsxs)(o.Z,{display:"flex",justifyContent:"center",gap:2,children:[(0,T.jsx)(Z.Z,{variant:"contained",loading:J,type:"submit","translation-key":"common_save",children:n("common_save")}),(0,T.jsx)(p.Z,{type:"button",color:"inherit",onClick:()=>W(I._.lecturer.course.assignment),"translation-key":"common_cancel",children:n("common_cancel")})]})})]})]})}),(0,T.jsx)(y.Z,{anchorOrigin:{vertical:"bottom",horizontal:"right"},open:Te,autoHideDuration:6e3,onClose:()=>Ae(!1),children:(0,T.jsx)(h.Z,{severity:"success",sx:{width:"100%"},onClose:()=>Ae(!1),children:n(ge?"update_successful_assignment":"create_successful_assignment")})}),(0,T.jsx)(y.Z,{anchorOrigin:{vertical:"bottom",horizontal:"right"},open:qe,autoHideDuration:6e3,onClose:()=>De(!1),children:(0,T.jsx)(h.Z,{severity:"error",sx:{width:"100%"},onClose:()=>De(!1),children:n("create_failed_assignment")})})]})}}}]);